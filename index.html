<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>CS 4621: Final Project -- Music Visualizer</title>

  <!-- Bootstrap -->
  <link href="css/bootstrap.min.css" rel="stylesheet">
  <link href="css/cs4620.css" rel="stylesheet">
  <link href="css/jquery-ui.min.css" rel="stylesheet">
  <link href="css/jquery-ui.theme.min.css" rel="stylesheet">
  <link href="css/jquery-ui.structure.min.css" rel="stylesheet">

  <script
  src="https://code.jquery.com/jquery-3.2.1.min.js"
  integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
  crossorigin="anonymous">
  </script>

  <script language="javascript" type="text/javascript" src="js/p5.js"></script>
  <script language="javascript" type="text/javascript" src="js/p5.sound.js"></script>
</head>

<body>

  <label for="js-song">Song:</label>
  <input type="file" id="js-song">

  <script>

  // NOT SURE WE WANT TO GO ON CHANGE, PROBABLY ON BUTTON PRESS, BUT TESTING FOR NOW

  $('#js-song').on('change', function() {

      var url = $(this).val();
      var song = url.split('\\').pop();
      console.log(song);

      var s = function(p) {

        p.preload = function() {
          sound = p.loadSound('assets/'+song);
        }

        p.setup = function() {
          fft = new p5.FFT();
          sound.amp(0.2);
          sound.play();
        }

        p.draw = function() {
          var spectrum = fft.analyze();
          var waveform = fft.waveform();
        }

      }

      var myp5 = new p5(s);

  });

  function main() {
    // Global Variables
    var sound;
    var fft;

    // Preload [sound]
    function preload() {
      // Initialize [sound]
      sound = loadSound('assets/doorbell.mp3');
    }

    // Setup Global Variables (AFTER preload)
    function setup() {
      // var cnv = createCanvas(100,100);
      // cnv.mouseClicked(togglePlay);

      // Initialize [fft]
      fft = new p5.FFT();

      // Set [sound] amplitude/volume
      sound.amp(0.2);
    }

    function draw() {
      // Reset Background Color

      // Get FFT spectrum
      var spectrum = fft.analyze();

      // Draw Spectrum
      console.log("spectrum");
      for (var i = 0; i < spectrum.length; i++){
        console.log("spectrum[i]: " + spectrum[i]);
        // var x = map(i, 0, spectrum.length, 0, width);
        // var h = -height + map(spectrum[i], 0, 255, height, 0)
      }

      // Get FFT waveform
      var waveform = fft.waveform();

      // Draw waveform
      console.log("waveform:");
      for (var i = 0; i< waveform.length; i++) {
        // var x = map(i, 0, waveform.length, 0, width);
        // var y = map( waveform[i], -1, 1, 0, height);
        console.log("waveform[i]: " + waveform[i]);
      }

      // Toggle [sound] play/pause
      function togglePlay() {
        if ( sound.isPlaying() ) {
          sound.pause();
        } else {
          sound.play();
        }
      }


      // Run -----------------------------
      preload();
      setup();
      sound.play();
  }

  </script>
</body>

</html>
