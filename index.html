<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>CS 4621: Final Project -- Music Visualizer</title>

  <!-- Bootstrap -->
  <link href="css/bootstrap.min.css" rel="stylesheet">
  <link href="css/cs4620.css" rel="stylesheet">
  <link href="css/jquery-ui.min.css" rel="stylesheet">
  <link href="css/jquery-ui.theme.min.css" rel="stylesheet">
  <link href="css/jquery-ui.structure.min.css" rel="stylesheet">

  <script
  src="https://code.jquery.com/jquery-3.2.1.min.js"
  integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
  crossorigin="anonymous">
  </script>

  <script language="javascript" type="text/javascript" src="js/p5.js"></script>
  <script language="javascript" type="text/javascript" src="js/p5.sound.js"></script>
  <script language="javascript" type="text/javascript" src="js/boilerplate.js"></script>
</head>

<body>

  <label for="js-song">Song:</label>
  <input type="file" id="js-song">
  <button id="play">Play</button>

  <div align="center">
    <canvas tabindex="1" id="webglCanvas" style="border: none; background-color: black;" width="800" height="600"></canvas>
  </div>

  <script id="vertexShader--sphere" type="x-shader/x-vertex">
    attribute vec3 position;
    void main() {
      gl_Position = vec4(position, 1.0);
    }
  </script>

  <script id="fragmentShader--sphere" type="x-shader/x-fragment">
    precision highp float;
    // uniform vec3 color;
    vec3 color = vec3(1.0);
    void main() {
      gl_FragColor = vec4(color, 1.0);
    }
  </script>

  <script>

  var gl = initializeWebGL($("#webglCanvas"));
  var sphere_shader = createGlslProgram(gl, "vertexShader--sphere", "fragmentShader--sphere");

  function updateWebGL(time) {
    gl.clearColor(0.15, 0.2, 0.5, 1.0);
    gl.clear(gl.COLOR_BUFFER_BIT);

    // Reschedule the next frame.
    window.requestAnimationFrame(updateWebGL);
  }
  window.requestAnimationFrame(updateWebGL);


  // NOT SURE WE WANT TO GO ON CHANGE, PROBABLY ON BUTTON PRESS, BUT TESTING FOR NOW

  $('#js-song').on('change', function() {

      var url = $(this).val();
      var song = url.split('\\').pop();
      console.log(song);

      var s = function(p) {

        p.preload = function() {
          p.soundFormats('m4a');
          sound = p.loadSound('assets/'+song);
        }

        p.setup = function() {
          fft = new p5.FFT();
          sound.amp(0.2);
        }

        p.draw = function() {
          var spectrum = fft.analyze();
          var waveform = fft.waveform();
        }

        p.togglePlay = function() {
          if ( sound.isPlaying() ) {
            sound.pause();
          } else {
            sound.play();
          }
        }

        $('#play').on('click', p.togglePlay);

      }

      var myp5 = new p5(s);

  });

  </script>
</body>

</html>
